<html>
<head>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.2/lodash.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/benchmark/2.1.2/benchmark.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fetch/2.0.1/fetch.min.js"></script>

<!-- script src="https://cdnjs.cloudflare.com/ajax/libs/memoizejs/0.1.1/memoize.min.js"></script -->

<!-- >script src="fast-memoize.js"></script>
<script src="moize.js"></script>
<script src="../index.js"></script -->
</head>
<body>
Enable browser debugging tools to see results. May take 5 to 10 seconds to see first result.
<script>

 function importFile(src) { 
		const me = this;
		//me.exports = {};
		return new Promise((resolve,reject) => {
			let script = document.createElement('script');
			script.onload = () => { 
				resolve(me); 
				//delete me.exports; 
			};
			script.setAttribute('src',src);
			document.head.appendChild(script);
		});
	}

 	var fibonacci = function(n) {
	    return n < 2 ? n : fibonacci(n - 1) + fibonacci(n - 2);
	}

	var fibonacciMultiplePrimitive = (number, isComplete) => {
		  if (isComplete) {
		    return number;
		  }

		  const firstValue = number - 1;
		  const secondValue = number - 2;

		  return fibonacciMultiplePrimitive(firstValue, firstValue < 2) + fibonacciMultiplePrimitive(secondValue, secondValue < 2);
		};

	var fibonacciMultipleObject = (number, check) => {
		  if (check.isComplete) {
		    return number;
		  }

		  const firstValue = number - 1;
		  const secondValue = number - 2;

		  return fibonacciMultipleObject(firstValue, {
		    isComplete: firstValue < 2
		  }) + fibonacciMultipleObject(secondValue, {
		    isComplete: secondValue < 2
		  });
		};

	var imports = ["https://cdnjs.cloudflare.com/ajax/libs/memoizejs/0.1.1/memoize.min.js","fast-memoize.js","moize.js","../index.js"];
	imports.forEach((file,i) => {
		imports[i] = importFile(file);
	});
	
	const setup = () => {
		
		var iMemoizedFibonacci = iMemoized.memoize(fibonacci),
		lodashFibonacci = _.memoize(fibonacci),
		fastMemoizedFibonacci = fastMemoize(fibonacci),
		moizeFibonacci = moize(fibonacci),
		memoizejs = memoize(fibonacci),
		iMemoizedMultiFibonacci = iMemoized.memoize(fibonacciMultiplePrimitive),
		moizeMultiFibonacci = moize(fibonacciMultiplePrimitive),
		memoizejsMultiFibonacci = memoize(fibonacciMultiplePrimitive),
		fastMemoizedMultiFibonacci = fastMemoize(fibonacciMultiplePrimitive),
		iMemoizedMultiObjectFibonacci = iMemoized.memoize(fibonacciMultipleObject),
		fastMemoizedMultiObjectFibonacci = fastMemoize(fibonacciMultipleObject),
		moizeMultiObjectFibonacci = moize(fibonacciMultipleObject);
		return {
			suites: {
				singleMemoize: {
					arguments: [35],
					expected: fibonacci(35),
					pretest: true,
					tests: {
						moizeFibonacci,
						iMemoizedFibonacci,
						lodashFibonacci,
						fastMemoizedFibonacci,
						memoizejs
					}
				},
				multiMemoize: {
					arguments: [35],
					expected: fibonacci(35),
					pretest: true,
					tests: {
						moizeMultiFibonacci,
						iMemoizedMultiFibonacci,
						memoizejsMultiFibonacci,
						fastMemoizedMultiFibonacci,
						//memoizee: memoizee
					}
				},
				multiObjectMemoize: {
					arguments: [35,{isComplete:false}],
					expected: fibonacci(35),
					pretest: true,
					tests: {
						moizeMultiObjectFibonacci,
						iMemoizedMultiObjectFibonacci,
						fastMemoizedMultiObjectFibonacci
						//memoizee: memoizee
					}
				}
			}
		};
	}
		
Promise.all(imports).then(() => {
	const benchmark = setup();
	
	const suites = {},
		invalid = [];
		
	Object.keys(benchmark.suites).forEach((suiteName) => {
		const suite = benchmark.suites[suiteName],
			testsuite = new Benchmark.Suite;
		suites[suiteName] = testsuite;
		Object.keys(suite.tests).forEach((testName) =>{
			if(suite.pretest) {
				if(suite.tests[testName](...suite.arguments)===suite.expected) {
					testsuite.add(testName,() => {
						if(suite.tests[testName](...suite.arguments)!=suite.expected) {
							console.log("WARNING: " + testName + " fails to return expected value under load!");
						};
					});
				} else {
					console.log("WARNING: Skipped " + testName + " which fails to return expected value during pretest!");
				}
			} else {
				testsuite.add(testName,() => {
					if(suite.tests[testName](...suite.arguments)!=suite.expected) {
						console.log("WARNING: " + testName + " fails to return expected value under load!");
					};
				});
			}
		});
	});
	
	Object.keys(suites).forEach((suiteName) => {
		console.log("Running ",suiteName,"...");
		suites[suiteName].on("cycle",function(event) {
			console.log(String(event.target));
			}).on('complete', function() {
			  console.log(suiteName + " fastest is " + this.filter("fastest").map("name"));
			}).run({async:false});
	});
});



</script>
</body>
</html>